import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'
import { getCurrentSession, logout } from '@/api/authentication'
import { IfLoggedIn, IfNotLoggedIn } from '@/component/authentication'

const inter = Inter({
  subsets: ['latin'],
  display: 'swap',
  fallback: ["inter", 'arial'],
})

export const metadata: Metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
}

export default async function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  const user = await getCurrentSession()
  return (
    <html lang="en">
      <body className={ inter.className }>
        <Header>
          <section>
            <p>ðŸ”’ <span data-lg>Next.js Simple Auth</span></p>
            <a href="/">Home</a>
          </section>
          <form>
            <IfNotLoggedIn>
              <a href="/login" data-primary>Log in</a>
              <a href="/register">Register</a>
            </IfNotLoggedIn>
            <IfLoggedIn>
              <span className="mr-2">
                { user?.username }
              </span>
              <a href="/settings">Settings</a>
            </IfLoggedIn>
          </form>
        </Header>
        <main>
          { children }
        </main>
      </body>
    </html >
  )
}


function Header({ children }: any) {
  return <header className="
    flex flex-row items-center justify-between max-w-screen-xl w-full mx-auto  
    px-4
    [&_p]:text-xl
    [&_p]:font-semibold
    [&_p]:text-white
    [&>section]:flex
    [&>section]:items-center
    [&>section]:gap-4
    [&_[data-lg]]:hidden
    [&_[data-lg]]:md:inline
  ">
    { children }
  </header>
}
